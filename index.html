<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shisha Time</title>

<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#160020;
  --card:#1f072b;
  --main:#8b5cf6;
  --accent:#22c55e;
  --text:#ffffff;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Tajawal',sans-serif;
  background:linear-gradient(135deg,#160020,#2a083a);
  color:var(--text);
}
header{
  padding:20px;
  text-align:center;
  font-size:28px;
  font-weight:700;
}
.container{
  max-width:420px;
  margin:auto;
  padding:15px;
}
.card{
  background:var(--card);
  border-radius:16px;
  padding:15px;
  margin-bottom:15px;
}
input{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:none;
  margin-bottom:10px;
  font-size:16px;
}
button{
  width:100%;
  padding:14px;
  border-radius:14px;
  border:none;
  font-size:18px;
  cursor:pointer;
}
.btn-main{background:var(--main);color:#fff}
.btn-green{background:var(--accent);color:#000;font-weight:700}
.product{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.product button{
  width:auto;
  padding:6px 12px;
  font-size:14px;
}
.hidden{display:none}
</style>
</head>

<body>

<header>Shisha Time ğŸŸ¡</header>

<div class="container">

<!-- LOGIN -->
<div class="card" id="loginBox">
<h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„">
<button class="btn-main" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- STORE -->
<div id="store" class="hidden">

<div class="card">
<h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
<div id="products"></div>
</div>

<div class="card">
<h3>Ø§Ù„Ø³Ù„Ø© ğŸ›’</h3>
<div id="cart">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</div>
</div>

<button class="btn-green" onclick="sendOrder()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨</button>

</div>

</div>

<script>
const API="https://shisha-time-backend.onrender.com";
let user={},cart=[];

function login(){
  const name=document.getElementById("name").value;
  const phone=document.getElementById("phone").value;
  if(!name||!phone)return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¬ÙˆØ§Ù„");
  user={name,phone};
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("store").classList.remove("hidden");
  loadProducts();
}

async function loadProducts(){
  const res=await fetch(API+"/products");
  const data=await res.json();
  const box=document.getElementById("products");
  box.innerHTML="";
  data.forEach(p=>{
    box.innerHTML+=`
    <div class="product">
      <span>${p.name} - ${p.price} Ø±ÙŠØ§Ù„</span>
      <button onclick='addToCart(${JSON.stringify(p)})'>+</button>
    </div>`;
  });
}

function addToCart(p){
  cart.push(p);
  renderCart();
}

function renderCart(){
  const box=document.getElementById("cart");
  if(cart.length==0){box.innerText="Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©";return;}
  let total=0;
  box.innerHTML="";
  cart.forEach(p=>{
    total+=p.price;
    box.innerHTML+=`<div>${p.name} - ${p.price} Ø±ÙŠØ§Ù„</div>`;
  });
  box.innerHTML+=`<hr>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø±ÙŠØ§Ù„`;
}

async function sendOrder(){
  if(cart.length==0)return alert("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©");
  const total=cart.reduce((s,p)=>s+p.price,0);
  const res=await fetch(API+"/order",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({name:user.name,phone:user.phone,total})
  });
  const data=await res.json();
  window.location.href=data.whatsappUrl;
}
</script>

</body>
</html>
